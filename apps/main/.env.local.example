# Environment Variables Example for Main App
# 
# ⚠️ IMPORTANT: This is a MONOREPO with multiple Next.js apps!
# Each app needs its own .env.local file with the SAME credentials.
# See ENV_SETUP_GUIDE.md for detailed setup instructions.
#
# Supabase Configuration
# To set up Supabase authentication:
# 1. Create a project at https://supabase.com
# 2. Go to Project Settings > API
# 3. Copy your Project URL and anon/public key
# 4. Create a .env.local file (copy this file) and add your values
# 5. Copy the same credentials to each learning module's .env.local
# 6. Never commit .env.local to git (it's in .gitignore)
#
# For Google OAuth setup, see GOOGLE_OAUTH_TROUBLESHOOTING.md

# Your Supabase project URL
# Example: https://xyzcompany.supabase.co
# ⚠️ REQUIRED - App will not start without this (unless SUPABASE_SUSPENDED=true)
NEXT_PUBLIC_SUPABASE_URL=your-project-url-here

# Your Supabase anonymous/public key
# This key is safe to use in the browser
# ⚠️ REQUIRED - App will not start without this (unless SUPABASE_SUSPENDED=true)
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# ============================================
# Supreme Admin Access (Server-Side Only)
# ============================================
#
# These variables power the "supreme" admin: access does NOT depend on Supabase
# user accounts, profiles, or RLS. All admin API routes use the service role key.
#
# ADMIN_PANEL_SECRET  — the passphrase entered on /admin/login
#   Validated server-side only; never exposed to the browser.
#   Generate a strong random secret, e.g.: openssl rand -base64 32
#
# ADMIN_SESSION_SIGNING_KEY — used to sign the HttpOnly admin_session JWT cookie
#   Must be at least 32 characters. Rotate when compromised.
#   Generate: openssl rand -base64 32
#
# ADMIN_IP_ALLOWLIST  — optional, comma-separated IPs that may access /api/admin/*
#   Leave unset to allow any IP (protected by secret alone).
#   Example: ADMIN_IP_ALLOWLIST=203.0.113.42,198.51.100.7
#
ADMIN_PANEL_SECRET=change-me-to-a-strong-random-secret
ADMIN_SESSION_SIGNING_KEY=change-me-to-a-strong-random-signing-key
# ADMIN_IP_ALLOWLIST=

# ============================================
# Admin Auth Bypass (Testing Only)
# ============================================
#
# ADMIN_AUTH_DISABLED=true  — skips ALL admin authentication.
#   /admin loads directly, /admin/login redirects to /admin.
#   ⚠️ NEVER set this to true in production with real user data.
#   Set to false (or remove) to re-enable normal passphrase auth.
#
# NEXT_PUBLIC_ADMIN_AUTH_DISABLED=true  — client-side counterpart.
#   Must match ADMIN_AUTH_DISABLED so the browser gate is also bypassed.
#
ADMIN_AUTH_DISABLED=true
NEXT_PUBLIC_ADMIN_AUTH_DISABLED=true

# ============================================
# Supabase Service Role Key (Server-Side Only)
# ============================================
#
# ⚠️ CRITICAL SECURITY: Keep this secret! Never expose to client-side code!
# This key bypasses Row Level Security and has full database access.
#
# Used for:
# - Admin operations requiring elevated privileges
# - Password-first admin authentication (TEST MODE)
# - Server-side admin queries with full access
#
# Get from: Supabase Dashboard → Project Settings → API → service_role key
# ⚠️ ROTATE THIS KEY after test period ends!
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# ============================================
# First-Time Admin Setup Mode (NEW FEATURE)
# ============================================
#
# ⚠️ SECURITY: Feature-flagged admin setup flow
#
# When enabled (set to "true"), allows unauthenticated access to /admin/setup
# for creating the first admin account. Automatically disables after setup.
#
# ONLY enable this when:
# - No admin account exists yet (first-time setup)
# - You need to recover admin access
# - You are setting up a new environment
#
# ⚠️ CRITICAL: Set back to "false" after admin account is created!
#
# Client-side flag (visible in browser):
NEXT_PUBLIC_ADMIN_SETUP_MODE=false

# Server-side flag (not visible in browser):
ADMIN_SETUP_MODE=false

# ============================================
# Temporary Auth Suspension (EMERGENCY ONLY)
# ============================================
#
# ⚠️ EXTREME CAUTION: Use only for emergency maintenance
#
# When enabled (set to "true"), temporarily suspends authentication checks
# across admin pages. This is different from TEST_MODE - it's more limited
# and requires explicit confirmation.
#
# ONLY enable this when:
# - Emergency maintenance is required
# - You need temporary access without proper auth
# - You have explicit approval from security team
#
# Requires ADMIN_SUSPEND_CONFIRM=true to actually take effect (double confirmation)
#
# ⚠️ CRITICAL: Disable immediately after emergency is resolved!
#
# Client-side flag:
NEXT_PUBLIC_TEMP_SUSPEND_AUTH=false

# Server-side flag:
TEMP_SUSPEND_AUTH=false

# Confirmation flag (required for suspension to work):
ADMIN_SUSPEND_CONFIRM=false

# ============================================
# Password-First Admin Authentication (TEST MODE)
# ============================================
#
# ⚠️ WARNING: FOR TESTING ONLY - DO NOT USE IN PRODUCTION
#
# JWT Secret for admin token signing
# Generate a secure random string (minimum 32 characters)
# Example: openssl rand -base64 32
# ⚠️ REQUIRED for password-first admin auth
# ⚠️ ROTATE/REMOVE after test period
ADMIN_JWT_SECRET=your-admin-jwt-secret-here

# ============================================
# Universal Public Access Mode (TESTING)
# ============================================
#
# ⚠️ FOR TESTING PHASE ONLY - DISABLES ALL AUTHENTICATION
#
# When enabled (set to "true"), the following happens:
# 1. All authentication checks are bypassed
# 2. All paywalls are removed
# 3. All content is accessible to everyone
# 4. Login/register pages are not required
# 5. Protected routes become publicly accessible
#
# **ADMIN ACCESS:** When true, admin section at http://localhost:3000/admin
# is immediately accessible without any login or password (first-time setup mode)
#
# Set to "true" for testing phase, "false" for production
NEXT_PUBLIC_DISABLE_AUTH=true

# ============================================
# Admin Secret Password (Subsequent Visits)
# ============================================
#
# Alternative admin access via secret password prompt
# When NEXT_PUBLIC_DISABLE_AUTH=false, admins can access /admin by entering
# this secret password instead of logging in with Supabase.
#
# **USAGE PATTERN (as per requirements):**
# - First visit: Set NEXT_PUBLIC_DISABLE_AUTH=true (open access)
# - Subsequent visits: Set NEXT_PUBLIC_DISABLE_AUTH=false and use this password
#
# Default password: 'iiskills123' (if not set)
# Custom password: Set your own secure password below
#
# ⚠️ SECURITY WARNING: This is for testing/demo purposes only!
# - Default password 'iiskills123' is public knowledge
# - Client-side validation can be bypassed
# - NEVER use in production with sensitive data
#
# To use a custom password (recommended for staging):
NEXT_PUBLIC_ADMIN_SECRET_PASSWORD=iiskills123

# ============================================
# LOCALHOST NAVIGATION - Admin Dashboard
# ============================================
#
# The admin dashboard includes navigation to all apps at these localhost ports:
# - Main Domain: http://localhost:3000
# - Learn AI: http://localhost:3024
# - Learn Management: http://localhost:3016
# - Learn PR: http://localhost:3021
# - Learn Math: http://localhost:3017
# - Learn Physics: http://localhost:3020
# - Learn Chemistry: http://localhost:3005
# - Learn Geography: http://localhost:3011
# - Learn Govt Jobs: http://localhost:3013
# - Learn APT: http://localhost:3002
# - Learn Developer: http://localhost:3007
#
# See ADMIN_ACCESS_LOCALHOST_GUIDE.md for complete setup instructions
#

# ============================================
# Test Mode Configuration
# ============================================
#
# ⚠️ CRITICAL WARNING: TEST MODE ONLY - NEVER ENABLE IN PRODUCTION
#
# When enabled (set to "true"), the following happens:
# 1. Password-first admin authentication is active
# 2. All paywalls are bypassed (all paid content is accessible)
# 3. Admin can access all content across all apps
# 4. All Supabase auth checks are relaxed for testing
#
# Client-side flag (visible in browser):
# NEXT_PUBLIC_TEST_MODE=false (set to "true" to enable test mode)
NEXT_PUBLIC_TEST_MODE=false

# Server-side flag (not visible in browser):
# TEST_MODE=false (set to "true" to enable server-side test mode)
TEST_MODE=false

# ============================================
# ROLLBACK INSTRUCTIONS (IMPORTANT!)
# ============================================
#
# After testing is complete, you MUST:
# 1. Set NEXT_PUBLIC_TEST_MODE=false
# 2. Set TEST_MODE=false
# 3. Remove or rotate ADMIN_JWT_SECRET
# 4. Rotate SUPABASE_SERVICE_ROLE_KEY
# 5. Drop admin_settings table from Supabase
# 6. Restore original Supabase-based admin authentication
# 7. Verify all changes are reverted
#
# See TEST_MODE_ROLLBACK.md for detailed instructions

# ============================================
# Supabase Suspension Mode (TEMPORARY)
# ============================================
#
# Set to "true" to suspend all Supabase connections temporarily
# This allows the app to run without database access for content review
# 
# When suspended:
# - All authentication operations will be disabled
# - Database queries will return empty results
# - Apps will show content without requiring login
# - No data will be read from or written to Supabase
#
# Development: false (default - use Supabase normally)
# Temporary suspension: true (disable Supabase for content review)
#
# ⚠️ IMPORTANT: This is a temporary feature for content review periods
# Set back to "false" and restart apps when ready to restore Supabase
NEXT_PUBLIC_SUPABASE_SUSPENDED=false

# Site URL for OAuth redirects
# Development: http://localhost:3000
# Staging:     https://app.iiskills.cloud  ← current live environment
# Production:  https://iiskills.cloud      ← set when DNS cutover is complete
# IMPORTANT: This must match one of the redirect URLs configured in Supabase
NEXT_PUBLIC_SITE_URL=https://app.iiskills.cloud

# Main domain (eventual primary domain — do not change)
# Staging serves from app.iiskills.cloud but iiskills.cloud remains the primary domain
NEXT_PUBLIC_MAIN_DOMAIN=iiskills.cloud

# Cookie domain for cross-subdomain authentication
# Development: Leave empty or undefined (cookies work on localhost)
# Production: .iiskills.cloud (note the leading dot - enables cross-subdomain auth)
# CRITICAL: The leading dot allows session sharing across all *.iiskills.cloud subdomains
NEXT_PUBLIC_COOKIE_DOMAIN=

# For production deployment, set:
# NEXT_PUBLIC_COOKIE_DOMAIN=.iiskills.cloud
# NEXT_PUBLIC_SITE_URL=https://iiskills.cloud

# ============================================
# Universal reCAPTCHA Configuration
# ============================================
#
# IMPORTANT: Use the SAME reCAPTCHA keys across ALL apps and subdomains
# This enables unified bot protection across the entire iiskills.cloud platform.
#
# CURRENT USAGE: Newsletter signups
# FUTURE USAGE: Registration, authentication, login, password reset forms
#
# Google reCAPTCHA v3 keys for universal usage
# Get your keys at: https://www.google.com/recaptcha/admin/create
# Choose reCAPTCHA v3 for invisible verification
#
# Setup Instructions:
# 1. Register a SINGLE site key for iiskills.cloud (this covers ALL subdomains)
# 2. In the reCAPTCHA admin console, add:
#    - Domain: iiskills.cloud (wildcard covers all *.iiskills.cloud subdomains)
# 3. Copy the SAME keys to ALL apps' .env.local files
# 4. All frontend forms (newsletter, and future auth/registration) will use these keys
# 5. All backend APIs will validate using the same secret key
#
# Public site key (visible in browser, same across all apps)
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=your-recaptcha-site-key-here

# Secret key (server-side only, never exposed to browser, same across all apps)
# ⚠️ IMPORTANT: Keep this secret!
RECAPTCHA_SECRET_KEY=your-recaptcha-secret-key-here

# ============================================
# Google OAuth Configuration Notes
# ============================================
# 
# After setting up the above, configure Google OAuth:
#
# 1. Enable Google provider in Supabase:
#    - Supabase Dashboard → Authentication → Providers → Google
#    - Toggle "Enable Sign in with Google" to ON
#
# 2. Configure Google Cloud Console:
#    - Create OAuth 2.0 Client ID (Web application)
#    - Add Supabase callback URL to Authorized redirect URIs:
#      https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback
#    - Add all domains to Authorized JavaScript origins
#      (see CALLBACK_URLS_REFERENCE.md for complete list)
#
# 3. Copy Client ID and Secret from Google Console to Supabase
#
# 4. Add redirect URLs to Supabase URL Configuration:
#    - Development: http://localhost:3000/**
#    - Production: https://iiskills.cloud/**
#    - Plus all subdomains (see CALLBACK_URLS_REFERENCE.md)
#
# For detailed troubleshooting, see:
# - GOOGLE_OAUTH_TROUBLESHOOTING.md
# - CALLBACK_URLS_REFERENCE.md
# - Run: ./google-oauth-check.sh to verify configuration

# ============================================
# Portal Feature Pages - API Keys (OPTIONAL)
# ============================================
#
# These API keys are for the Portal Feature Pages (Command Center):
# - Opportunity Feed (/opportunity-feed)
# - Daily Brief (/daily-brief)
# - Exam Countdown (/exam-countdown)
#
# ⚠️ IMPORTANT: All pages work perfectly with mock data by default.
# These API keys are OPTIONAL and only needed to enable live data.
# The app will run successfully without these keys.
#

# Opportunity Feed - Job/Internship APIs
# Get your key at: https://developer.adzuna.com/
NEXT_PUBLIC_ADZUNA_APP_ID=your-adzuna-app-id-here
NEXT_PUBLIC_ADZUNA_API_KEY=your-adzuna-api-key-here

# Daily Brief - News API
# Get your key at: https://newsapi.org/
NEXT_PUBLIC_NEWS_API_KEY=your-newsapi-key-here

# Daily Brief - AI Summarization (server-side only)
# Get your key at: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here
# OR use Gemini as backup: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your-gemini-api-key-here

# ============================================
# ai-enter Payment Callback (Server-Side Only)
# ============================================
#
# Shared secret between ai-enter and iiskills for HMAC-SHA256 signature
# verification of server-to-server payment callbacks.
#
# Flow:
#   User pays at https://aienter.in/payments/iiskills
#   → ai-enter POSTs to https://iiskills.cloud/api/payments/ai-enter/callback
#   → iiskills verifies X-AI-ENTER-SIGNATURE = hmac_sha256(rawBody, secret)
#   → iiskills generates & sends 6-digit OTP to user's phone
#   → User visits /otp-gateway, enters OTP, becomes PAID Learner instantly
#
# Generate: openssl rand -hex 32
# ⚠️ MUST match ORIGIN_WEBHOOK_SECRET in your ai-enter deployment
ORIGIN_WEBHOOK_SECRET=change-me-to-a-strong-random-secret

# Callback URL registered in ai-enter (IISKILLS_WEBHOOK_URL)
# Used by ai-enter to know where to POST payment events
# Production: https://iiskills.cloud/api/payments/ai-enter/callback
IISKILLS_WEBHOOK_URL=https://iiskills.cloud/api/payments/ai-enter/callback
