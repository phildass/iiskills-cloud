# Supabase Configuration
# 
# ⚠️ IMPORTANT: This is a MONOREPO with multiple Next.js apps!
# Each app needs its own .env.local file with the SAME credentials.
# See ENV_SETUP_GUIDE.md for detailed setup instructions.
#
# To set up Supabase authentication:
# 1. Create a project at https://supabase.com
# 2. Go to Project Settings > API
# 3. Copy your Project URL and anon/public key
# 4. Create a .env.local file (copy this file) and add your values
# 5. Copy the same credentials to each learning module's .env.local
# 6. Never commit .env.local to git (it's in .gitignore)
#
# For Google OAuth setup, see GOOGLE_OAUTH_TROUBLESHOOTING.md

# Your Supabase project URL
# Example: https://xyzcompany.supabase.co
# ⚠️ REQUIRED - App will not start without this (unless SUPABASE_SUSPENDED=true)
NEXT_PUBLIC_SUPABASE_URL=your-project-url-here

# Your Supabase anonymous/public key
# This key is safe to use in the browser
# ⚠️ REQUIRED - App will not start without this (unless SUPABASE_SUSPENDED=true)
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# ============================================
# Supabase Suspension Mode (TEMPORARY)
# ============================================
#
# Set to "true" to suspend all Supabase connections temporarily
# This allows the app to run without database access for content review
# 
# When suspended:
# - All authentication operations will be disabled
# - Database queries will return empty results
# - Apps will show content without requiring login
# - No data will be read from or written to Supabase
#
# Development: false (default - use Supabase normally)
# Temporary suspension: true (disable Supabase for content review)
#
# ⚠️ IMPORTANT: This is a temporary feature for content review periods
# Set back to "false" and restart apps when ready to restore Supabase
NEXT_PUBLIC_SUPABASE_SUSPENDED=false

# ============================================
# Local Content Mode (TESTING/QA)
# ============================================
#
# Set to "true" to enable local content mode for testing and QA
# This allows admin UIs to read from a local JSON snapshot instead of Supabase
#
# When enabled:
# - Admin UIs will fetch data from seeds/content.json
# - Authentication is bypassed (no user login required)
# - Write operations (insert/update/delete) are mocked (no data persistence)
# - Storage and RPC operations are not supported
#
# Development/QA: true (for testing with local data)
# Production: false (default - use Supabase normally)
#
# ⚠️ IMPORTANT: Only for local, staging, or test instances
# See seeds/README.md for usage instructions and examples
NEXT_PUBLIC_USE_LOCAL_CONTENT=false

# Site URL for OAuth redirects
# Development: http://localhost:3000
# Staging:     https://app.iiskills.cloud  ← current live environment
# Production:  https://iiskills.cloud      ← set when DNS cutover is complete
# 
# ⚠️ IMPORTANT: This is now OPTIONAL for multi-domain setups!
# The auth system uses runtime domain detection (window.location.origin)
# which ensures users stay on the same domain after authentication.
# 
# NEXT_PUBLIC_SITE_URL is only used as a fallback on the server-side.
# For multi-domain deployments, each app automatically detects its own domain.
# 
# This must match one of the redirect URLs configured in Supabase
NEXT_PUBLIC_SITE_URL=https://app.iiskills.cloud

# Main domain (eventual primary domain — do not change)
# Staging serves from app.iiskills.cloud but iiskills.cloud remains the primary domain
NEXT_PUBLIC_MAIN_DOMAIN=iiskills.cloud

# Cookie domain for cross-subdomain authentication
# Development: Leave empty or undefined (cookies work on localhost)
# Production: .iiskills.cloud (note the leading dot - enables cross-subdomain auth)
# CRITICAL: The leading dot allows session sharing across all *.iiskills.cloud subdomains
NEXT_PUBLIC_COOKIE_DOMAIN=

# For production deployment, set:
# NEXT_PUBLIC_COOKIE_DOMAIN=.iiskills.cloud
# NEXT_PUBLIC_SITE_URL=https://iiskills.cloud

# ============================================
# Open Access Mode (Production-Ready)
# ============================================
#
# Set to "true" to enable complete open access mode across the entire monorepo.
# When enabled, ALL authentication, login, signup, registration, paywall, and 
# restriction logic is fully bypassed. Any user (including unauthenticated guests) 
# can freely access and use every section and feature of every app (including main).
#
# Usage:
#   OPEN_ACCESS=true    - Enable open access mode (no NEXT_PUBLIC_ prefix needed)
#
# When OPEN_ACCESS=true:
# - No login, sign-in, verification, or payment prompts
# - All protected routes become publicly accessible
# - All paywalls are bypassed
# - Guest users have full access to all features
# - Works across all 11 learning apps and the main portal
#
# Development/Demo: true (for unrestricted access)
# Production: false (to enforce authentication and paywalls)
#
# Note: This automatically sets NEXT_PUBLIC_OPEN_ACCESS on the client side
OPEN_ACCESS=false

# ============================================
# TEMPORARY OPEN ACCESS CONFIGURATION (Legacy)
# ============================================
# 
# Legacy environment variable for backward compatibility.
# Use OPEN_ACCESS (above) for new deployments.
# 
# For testing, demo, and preview purposes, enable temporary open access:
# 
# QUICK ENABLE: Run the activation script
#   ./scripts/enable-open-access.sh
# 
# MANUAL ENABLE: Set these variables to 'true'
#   NEXT_PUBLIC_DISABLE_AUTH=true
#   NEXT_PUBLIC_PAYWALL_ENABLED=false
# 
# RESTORE: When testing is complete, run
#   ./scripts/restore-authentication.sh
# 
# DOCUMENTATION: See TEMPORARY_OPEN_ACCESS.md for full details
# 
# ============================================
# Universal Public Access Configuration
# ============================================
#
# IMPORTANT: System is now in FULLY PUBLIC/UNRESTRICTED mode
# All content from all learn-* apps is accessible without authentication
#
# Set to "false" to DISABLE authentication and enable public access (DEFAULT)
# Set to "true" to ENABLE authentication and restrict access
#
# Current Mode: FULLY PUBLIC (no login/paywall required)
# To re-enable authentication: set NEXT_PUBLIC_DISABLE_AUTH=true
NEXT_PUBLIC_DISABLE_AUTH=false

# ============================================
# Secret Password Admin Access (Optional)
# ============================================
#
# Alternative admin access via secret password prompt
# When authentication is enabled (NEXT_PUBLIC_DISABLE_AUTH=false), users can
# enter a secret password to gain admin access without logging in.
#
# ⚠️ SECURITY WARNING: This is for testing/demo purposes only!
# - Default password 'iiskills123' is public knowledge
# - Client-side validation can be bypassed
# - NEVER use in production with sensitive data
#
# To use a custom password (recommended for staging):
# NEXT_PUBLIC_ADMIN_SECRET_PASSWORD=your_custom_secure_password
#
# To disable this feature: Remove or don't set this variable
# The feature will still work with the default password if not set
NEXT_PUBLIC_ADMIN_SECRET_PASSWORD=

# ============================================
# Paywall Configuration
# ============================================
#
# Control paywall behavior across all apps
# Set to "false" to disable all paywalls for testing
# Set to "true" to enable normal paywall behavior (default)
#
# Development: false (for unrestricted testing)
# Production: true (to enforce paywalls)
NEXT_PUBLIC_PAYWALL_ENABLED=false

# ============================================
# Universal reCAPTCHA Configuration
# ============================================
#
# IMPORTANT: Use the SAME reCAPTCHA keys across ALL apps and subdomains
# This enables unified bot protection across the entire iiskills.cloud platform.
#
# CURRENT USAGE: Newsletter signups
# FUTURE USAGE: Registration, authentication, login, password reset forms
#
# Google reCAPTCHA v3 keys for universal usage
# Get your keys at: https://www.google.com/recaptcha/admin/create
# Choose reCAPTCHA v3 for invisible verification
#
# Setup Instructions:
# 1. Register a SINGLE site key for iiskills.cloud (this covers ALL subdomains)
# 2. In the reCAPTCHA admin console, add:
#    - Domain: iiskills.cloud (wildcard covers all *.iiskills.cloud subdomains)
# 3. Copy the SAME keys to ALL apps' .env.local files
# 4. All frontend forms (newsletter, and future auth/registration) will use these keys
# 5. All backend APIs will validate using the same secret key
#
# Public site key (visible in browser, same across all apps)
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=your-recaptcha-site-key-here

# Secret key (server-side only, never exposed to browser, same across all apps)
# ⚠️ IMPORTANT: Keep this secret!
RECAPTCHA_SECRET_KEY=your-recaptcha-secret-key-here

# ============================================
# AI-Powered Newsletter Configuration
# ============================================
#
# OpenAI API key for AI-powered newsletter generation
# Get your key at: https://platform.openai.com/api-keys
# ⚠️ IMPORTANT: Keep this secret!
OPENAI_API_KEY=your-openai-api-key-here

# SendGrid Configuration (Primary Email Provider)
# Get your API key at: https://app.sendgrid.com/settings/api_keys
# ⚠️ IMPORTANT: Keep this secret!
# 
# SETUP INSTRUCTIONS:
# 1. Create account at https://sendgrid.com
# 2. Navigate to Settings → API Keys
# 3. Create a new API key with "Full Access" or "Mail Send" permission
# 4. Copy the API key (you'll only see it once)
# 5. Add domain authentication in SendGrid dashboard for better deliverability
# 6. Configure sender identity (single sender or domain authentication)
SENDGRID_API_KEY=your-sendgrid-api-key-here

# Optional: SendGrid Unsubscribe Group ID
# Create an unsubscribe group in SendGrid dashboard for newsletter management
SENDGRID_UNSUBSCRIBE_GROUP_ID=your-unsubscribe-group-id

# Sender email address and name
# ⚠️ CRITICAL: Must use a verified/authenticated domain or sender identity
# 
# For SendGrid with domain authentication:
# Option 1: Use subdomain: newsletter@send.iiskills.cloud
# Option 2: Use root domain: newsletter@iiskills.cloud
# Option 3: Use any verified sender: info@iiskills.cloud
# 
# The sender email MUST be verified in SendGrid dashboard
SENDER_EMAIL=newsletter@iiskills.cloud
SENDER_NAME=Skilling by iiskills.cloud

# ============================================
# Razorpay Payment Gateway Configuration
# ============================================
#
# Razorpay integration for payment processing and membership management
# Get your credentials at: https://dashboard.razorpay.com/app/keys
# 
# SETUP INSTRUCTIONS:
# 1. Create account at https://razorpay.com
# 2. Get your API Key ID and Secret from Settings → API Keys
# 3. For testing: Use Test Mode credentials (starts with rzp_test_)
# 4. For production: Use Live Mode credentials (starts with rzp_live_)
# 5. Configure webhook URL in Razorpay Dashboard → Webhooks
#    URL: https://yourdomain.com/api/payment/webhook
#    Events: payment.captured, payment.failed
# 6. Copy the webhook secret from the webhook configuration
#
# ⚠️ CRITICAL SECURITY:
# - NEVER commit real credentials to git
# - Use Test Mode for development (rzp_test_*)
# - Keep webhook secret secure - used for signature verification
# - Store in environment variables, not in code
#
# Payment mode: "test" (no real charges) or "live" (real charges).
# Default: derived from the key prefix (rzp_test_* → test, rzp_live_* → live).
# Setting RAZORPAY_MODE=test when using rzp_test_* keys in a PRODUCTION
# deployment lets you do end-to-end payment testing without risk of live charges.
# The /api/pay endpoint will reject live keys when RAZORPAY_MODE=test.
RAZORPAY_MODE=test

# Test Mode (Development / Production-test):
RAZORPAY_KEY_ID=rzp_test_your_key_id_here
RAZORPAY_KEY_SECRET=your_test_key_secret_here
RAZORPAY_WEBHOOK_SECRET=your_webhook_secret_here

# Live Mode (Production - DO NOT USE TEST CREDENTIALS IN PRODUCTION):
# RAZORPAY_MODE=live
# RAZORPAY_KEY_ID=rzp_live_your_key_id_here
# RAZORPAY_KEY_SECRET=your_live_key_secret_here
# RAZORPAY_WEBHOOK_SECRET=your_live_webhook_secret_here

# ============================================
# Google OAuth Configuration Notes
# ============================================
# 
# After setting up the above, configure Google OAuth:
#
# 1. Enable Google provider in Supabase:
#    - Supabase Dashboard → Authentication → Providers → Google
#    - Toggle "Enable Sign in with Google" to ON
#
# 2. Configure Google Cloud Console:
#    - Create OAuth 2.0 Client ID (Web application)
#    - Add Supabase callback URL to Authorized redirect URIs:
#      https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback
#    - Add all domains to Authorized JavaScript origins
#      (see CALLBACK_URLS_REFERENCE.md for complete list)
#
# 3. Copy Client ID and Secret from Google Console to Supabase
#
# 4. Add redirect URLs to Supabase URL Configuration:
#    - Development: http://localhost:3000/**
#    - Production: https://iiskills.cloud/**
#    - Plus all subdomains (see CALLBACK_URLS_REFERENCE.md)
#
# For detailed troubleshooting, see:
# - GOOGLE_OAUTH_TROUBLESHOOTING.md
# - CALLBACK_URLS_REFERENCE.md
# - Run: ./google-oauth-check.sh to verify configuration

# ============================================
# Universal Admin Dashboard Configuration
# ============================================
#
# Enable DEBUG_ADMIN mode to bypass authentication for admin dashboard
# This allows immediate access to /admin route for testing
#
# IMPORTANT: In production, admin routes are protected by passphrase
# authentication (ADMIN_PANEL_SECRET + signed session cookie).
# Set ADMIN_AUTH_DISABLED=true only for local dev / sandbox deployments.
#
# Development/Testing: true (for quick access during development)
# Production: false (require proper authentication)
#
# Current Mode: Set to "true" for public-access dev builds
DEBUG_ADMIN=true
NEXT_PUBLIC_DEBUG_ADMIN=true

# Admin auth bypass flags (development only — MUST be false in production)
ADMIN_AUTH_DISABLED=true
NEXT_PUBLIC_DISABLE_ADMIN_GATE=true

# Admin passphrase + session signing key (required in production)
# ADMIN_PANEL_SECRET=change-this-to-a-strong-passphrase
# ADMIN_SESSION_SIGNING_KEY=your-secure-session-signing-key-32-chars-min

# ============================================
# Global Free Access Mode
# ============================================
#
# When enabled, the platform treats all paid content as accessible without
# modifying security — a legitimate product switch for campaigns or open-access
# periods.
#
# NEXT_PUBLIC_FREE_ACCESS  — read by client-side bundles (Next.js inlines at build time)
# FREE_ACCESS              — read by the server/API layer only
#
# Both must be set to "true" to enable free access end-to-end.
#
# How to enable for a campaign:
#   1. Set NEXT_PUBLIC_FREE_ACCESS=true (and optionally FREE_ACCESS=true for
#      server/API consistency) in your .env.local or production env vars.
#   2. Rebuild / restart the application (env vars are inlined at build time).
#   3. Confirm no paywall UI appears and all lesson routes are accessible.
#
# Note on flag behaviour:
#   - NEXT_PUBLIC_FREE_ACCESS is read by client bundles (inlined by Next.js
#     at build time) AND by the server at runtime via process.env.
#   - FREE_ACCESS is read only on the server/API layer.
#   - Setting either flag to "true" is sufficient to enable free access on
#     that layer. Set both for end-to-end coverage.
#
# How to disable (restore normal paywall behaviour):
#   1. Set both vars to "false" (or remove them entirely).
#   2. Rebuild / restart the application.
#
# Default: false (paywall active)
NEXT_PUBLIC_FREE_ACCESS=false
FREE_ACCESS=false

